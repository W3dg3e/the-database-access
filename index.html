<!-- TEST: IF YOU SEE THIS, YOU EDITED THE RIGHT FILE -->

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>THE DATABASE ACCESS</title>

<style>
body {
  background: black;
  color: #00ff88;
  font-family: monospace;
  text-align: center;
  padding-top: 40px;
}

input, button {
  background: black;
  color: #00ff88;
  border: 1px solid #00ff88;
  padding: 6px;
  margin: 6px;
}
</style>
</head>

<body>

<h2>THE_DATABASE_ACCESS</h2>

<input id="email" placeholder="EMAIL"><br>
<input id="password" type="password" placeholder="PASSWORD"><br>
<input id="username" placeholder="USERNAME (UNIQUE)"><br>
<input id="display" placeholder="DISPLAY_NAME"><br>


<button onclick="signup()">SIGN_UP</button>
<button onclick="login()">LOG_IN</button>

<p id="status"></p>

<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "PASTE_API_KEY_HERE",
  authDomain: "PASTE_AUTH_DOMAIN_HERE",
  projectId: "PASTE_PROJECT_ID_HERE"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

const status = document.getElementById("status");

function signup() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const username = document.getElementById("username").value;
  const display = document.getElementById("display").value;

  if (!username || !display) {
    status.innerText = "USERNAME_AND_DISPLAY_REQUIRED";
    return;
  }

  db.collection("usernames").doc(username).get().then(doc => {
    if (doc.exists) {
      status.innerText = "USERNAME_ALREADY_TAKEN";
    } else {
      auth.createUserWithEmailAndPassword(email, password)
        .then(cred => {
          return db.collection("users").doc(cred.user.uid).set({
            username: username,
            displayName: display
          }).then(() => {
            return db.collection("usernames").doc(username).set({
              uid: cred.user.uid
            });
          });
        })
        .then(() => {
          status.innerText = "ACCOUNT_CREATED";
        })
        .catch(err => {
          status.innerText = err.message;
        });
    }
  });
}

function login() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  auth.signInWithEmailAndPassword(email, password)
    .then(() => {
      status.innerText = "LOGGED_IN";
    })
    .catch(err => {
      status.innerText = err.message;
    });
}
</script>


</body>
</html>
