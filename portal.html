<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>THE_DATABASE_ACCESS</title>

<style>
body {
  background: black;
  color: #00ff66;
  font-family: monospace;
  padding: 12px;
}

input, button {
  background: black;
  color: #00ff66;
  border: 1px solid #00ff66;
  margin: 4px 0;
  font-family: monospace;
}

.hidden { display: none; }

button.verify {
  color: cyan;
  border-color: cyan;
}
</style>
</head>

<body>

<div id="loggedOut">
  username:<br>
  <input id="username"><br>
  display.name:<br>
  <input id="display"><br>
  password:<br>
  <input id="password" type="password"><br>
  <button onclick="login()">SIGN_IN</button>
</div>

<div id="loggedIn" class="hidden">
  logged.in.as.<span id="name"></span><br><br>

  <button class="verify" onclick="openVerification()">VERIFICATION_</button><br><br>

  <div id="verificationBox" class="hidden">
    email:<br>
    <input id="email"><br>
    <button onclick="sendCode()">SEND_CODE</button><br><br>

    code:<br>
    <input id="code"><br>
    <button onclick="confirmCode()">CONFIRM</button><br><br>
  </div>

  <div id="verifiedText"></div><br>

  <button onclick="logout()">LOG_OUT</button>
</div>

<script>
/* ===== CONFIG ===== */
const API_URL = "https://script.google.com/macros/s/AKfycbyM3hpHWugB-9b-nlXz4HO6ORR_D3j6k2Ge5Hixfwmn7HS1GCIMh78camNX7-nGxwdGOw/exec";

/* ===== LOGIN SYSTEM ===== */
function login() {
  const display = document.getElementById("display").value;
  if (!display) return;

  localStorage.setItem("displayName", display);
  showState();
}

function logout() {
  localStorage.removeItem("displayName");
  localStorage.removeItem("verifiedEmail");
  showState();
}

function showState() {
  const name = localStorage.getItem("displayName");
  const email = localStorage.getItem("verifiedEmail");

  if (name) {
    document.getElementById("loggedOut").classList.add("hidden");
    document.getElementById("loggedIn").classList.remove("hidden");
    document.getElementById("name").textContent = name;
  } else {
    document.getElementById("loggedIn").classList.add("hidden");
    document.getElementById("loggedOut").classList.remove("hidden");
  }

  if (email) {
    document.getElementById("verifiedText").textContent =
      "verified.as." + email;
  } else {
    document.getElementById("verifiedText").textContent = "";
  }
}

/* ===== VERIFICATION ===== */
function openVerification() {
  document.getElementById("verificationBox").classList.remove("hidden");
}

function sendCode() {
  const email = document.getElementById("email").value;
  if (!email) return;

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "send",
      email: email
    })
  });
}

function confirmCode() {
  const email = document.getElementById("email").value;
  const code = document.getElementById("code").value;

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "verify",
      email: email,
      code: code
    })
  })
  .then(r => r.text())
  .then(result => {
    if (result === "VERIFIED") {
      localStorage.setItem("verifiedEmail", email);
      showState();
      document.getElementById("verificationBox").classList.add("hidden");
    }
  });
}

showState();
</script>

</body>
</html>
